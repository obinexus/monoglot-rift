<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1160 820">
  <!-- Background -->
  <rect width="1160" height="820" fill="#f8f9fa" />
  
  <!-- Title -->
  <text x="580" y="30" text-anchor="middle" font-family="Arial" font-size="24" font-weight="bold">LibRift Client Architecture</text>
  
  <!-- Core Classes -->
  
  <!-- RiftClient -->
  <rect x="450" y="60" width="220" height="90" fill="#e6f7ff" stroke="#1890ff" stroke-width="2" rx="5" />
  <text x="560" y="85" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">RiftClient</text>
  <line x1="450" y1="95" x2="670" y2="95" stroke="#1890ff" stroke-width="2" />
  <text x="460" y="115" font-family="Arial" font-size="12">- pipelines: Map&lt;String, Pipeline&gt;</text>
  <text x="460" y="135" font-family="Arial" font-size="12">+ createPipeline(name): Pipeline</text>
  
  <!-- Pipeline Classes -->
  <rect x="120" y="200" width="220" height="160" fill="#f6ffed" stroke="#52c41a" stroke-width="2" rx="5" />
  <text x="230" y="225" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">Pipeline</text>
  <line x1="120" y1="235" x2="340" y2="235" stroke="#52c41a" stroke-width="2" />
  <text x="130" y="255" font-family="Arial" font-size="12">- tokenizer: RiftTokenizer</text>
  <text x="130" y="275" font-family="Arial" font-size="12">- parser: RiftParser</text>
  <text x="130" y="295" font-family="Arial" font-size="12">- astBuilder: RiftAstBuilder</text>
  <line x1="120" y1="305" x2="340" y2="305" stroke="#52c41a" stroke-width="2" />
  <text x="130" y="325" font-family="Arial" font-size="12">+ setTokenizer(tokenizer)</text>
  <text x="130" y="345" font-family="Arial" font-size="12">+ setParser(parser)</text>
  <text x="130" y="365" font-family="Arial" font-size="12">+ process(input): RiftResult</text>
  
  <!-- Tokenizer -->
  <rect x="120" y="400" width="220" height="180" fill="#fff2e8" stroke="#fa8c16" stroke-width="2" rx="5" />
  <text x="230" y="425" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">RiftTokenizer</text>
  <line x1="120" y1="435" x2="340" y2="435" stroke="#fa8c16" stroke-width="2" />
  <text x="130" y="455" font-family="Arial" font-size="12">- rules: List&lt;TokenRule&gt;</text>
  <text x="130" y="475" font-family="Arial" font-size="12">- options: TokenizerOptions</text>
  <line x1="120" y1="485" x2="340" y2="485" stroke="#fa8c16" stroke-width="2" />
  <text x="130" y="505" font-family="Arial" font-size="12">+ addRule(pattern, type)</text>
  <text x="130" y="525" font-family="Arial" font-size="12">+ tokenize(input): List&lt;Token&gt;</text>
  <text x="130" y="545" font-family="Arial" font-size="12">+ setIgnorePattern(pattern)</text>
  <text x="130" y="565" font-family="Arial" font-size="12">+ setCaseSensitive(bool)</text>
  
  <!-- Parser -->
  <rect x="430" y="400" width="220" height="180" fill="#f9f0ff" stroke="#722ed1" stroke-width="2" rx="5" />
  <text x="540" y="425" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">RiftParser</text>
  <line x1="430" y1="435" x2="650" y2="435" stroke="#722ed1" stroke-width="2" />
  <text x="440" y="455" font-family="Arial" font-size="12">- grammar: Map&lt;String, Rule&gt;</text>
  <text x="440" y="475" font-family="Arial" font-size="12">- startSymbol: String</text>
  <line x1="430" y1="485" x2="650" y2="485" stroke="#722ed1" stroke-width="2" />
  <text x="440" y="505" font-family="Arial" font-size="12">+ addRule(name, pattern)</text>
  <text x="440" y="525" font-family="Arial" font-size="12">+ parse(tokens): ParseTree</text>
  <text x="440" y="545" font-family="Arial" font-size="12">+ setStartSymbol(name)</text>
  <text x="440" y="565" font-family="Arial" font-size="12">+ addErrorRecovery(strategy)</text>
  
  <!-- AST Builder -->
  <rect x="740" y="400" width="220" height="180" fill="#fff0f6" stroke="#eb2f96" stroke-width="2" rx="5" />
  <text x="850" y="425" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">RiftAstBuilder</text>
  <line x1="740" y1="435" x2="960" y2="435" stroke="#eb2f96" stroke-width="2" />
  <text x="750" y="455" font-family="Arial" font-size="12">- visitors: Map&lt;String, Visitor&gt;</text>
  <text x="750" y="475" font-family="Arial" font-size="12">- transformations: List&lt;Transform&gt;</text>
  <line x1="740" y1="485" x2="960" y2="485" stroke="#eb2f96" stroke-width="2" />
  <text x="750" y="505" font-family="Arial" font-size="12">+ addVisitor(nodeName, visitor)</text>
  <text x="750" y="525" font-family="Arial" font-size="12">+ buildAst(parseTree): AstNode</text>
  <text x="750" y="545" font-family="Arial" font-size="12">+ addTransformation(transform)</text>
  <text x="750" y="565" font-family="Arial" font-size="12">+ optimize(ast): AstNode</text>
  
  <!-- Token, ParseTree and AST Classes -->
  <rect x="120" y="620" width="180" height="100" fill="#fff2e8" stroke="#fa8c16" stroke-width="2" rx="5" />
  <text x="210" y="645" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">Token</text>
  <line x1="120" y1="655" x2="300" y2="655" stroke="#fa8c16" stroke-width="2" />
  <text x="130" y="675" font-family="Arial" font-size="12">+ type: String</text>
  <text x="130" y="695" font-family="Arial" font-size="12">+ value: String</text>
  <text x="130" y="715" font-family="Arial" font-size="12">+ position: Position</text>
  
  <rect x="430" y="620" width="220" height="140" fill="#f9f0ff" stroke="#722ed1" stroke-width="2" rx="5" />
  <text x="540" y="645" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">ParseTree</text>
  <line x1="430" y1="655" x2="650" y2="655" stroke="#722ed1" stroke-width="2" />
  <text x="440" y="675" font-family="Arial" font-size="12">+ type: String</text>
  <text x="440" y="695" font-family="Arial" font-size="12">+ children: List&lt;ParseTree&gt;</text>
  <text x="440" y="715" font-family="Arial" font-size="12">+ token: Token</text>
  <text x="440" y="735" font-family="Arial" font-size="12">+ getAttribute(name): Object</text>
  
  <rect x="740" y="620" width="220" height="140" fill="#fff0f6" stroke="#eb2f96" stroke-width="2" rx="5" />
  <text x="850" y="645" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">AstNode</text>
  <line x1="740" y1="655" x2="960" y2="655" stroke="#eb2f96" stroke-width="2" />
  <text x="750" y="675" font-family="Arial" font-size="12">+ type: String</text>
  <text x="750" y="695" font-family="Arial" font-size="12">+ children: Map&lt;String, AstNode&gt;</text>
  <text x="750" y="715" font-family="Arial" font-size="12">+ attributes: Map&lt;String, Object&gt;</text>
  <text x="750" y="735" font-family="Arial" font-size="12">+ accept(visitor): Object</text>
  
  <!-- Automaton Components -->
  <rect x="740" y="200" width="300" height="160" fill="#e6f7ff" stroke="#1890ff" stroke-width="2" rx="5" />
  <text x="890" y="225" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">RiftAutomatonFactory</text>
  <line x1="740" y1="235" x2="1040" y2="235" stroke="#1890ff" stroke-width="2" />
  <text x="750" y="255" font-family="Arial" font-size="12">+ createAutomaton(type): Automaton</text>
  <text x="750" y="275" font-family="Arial" font-size="12">+ createState(accepting): State</text>
  <text x="750" y="295" font-family="Arial" font-size="12">+ addTransition(from, to, pattern)</text>
  <text x="750" y="315" font-family="Arial" font-size="12">+ convertNfaToDfa(nfa): Automaton</text>
  <text x="750" y="335" font-family="Arial" font-size="12">+ minimizeDfa(dfa): Automaton</text>
  <text x="750" y="355" font-family="Arial" font-size="12">+ createPatternMatcher(pattern): Matcher</text>
  
  <!-- Result Class -->
  <rect x="430" y="200" width="220" height="160" fill="#e6f7ff" stroke="#1890ff" stroke-width="2" rx="5" />
  <text x="540" y="225" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">RiftResult</text>
  <line x1="430" y1="235" x2="650" y2="235" stroke="#1890ff" stroke-width="2" />
  <text x="440" y="255" font-family="Arial" font-size="12">- tokens: List&lt;Token&gt;</text>
  <text x="440" y="275" font-family="Arial" font-size="12">- parseTree: ParseTree</text>
  <text x="440" y="295" font-family="Arial" font-size="12">- ast: AstNode</text>
  <text x="440" y="315" font-family="Arial" font-size="12">- errors: List&lt;CompileError&gt;</text>
  <line x1="430" y1="325" x2="650" y2="325" stroke="#1890ff" stroke-width="2" />
  <text x="440" y="345" font-family="Arial" font-size="12">+ getTokens(): List&lt;Token&gt;</text>
  <text x="440" y="365" font-family="Arial" font-size="12">+ getAst(): AstNode</text>
  
  <!-- RiftCompiler -->
  <rect x="430" y="750" width="300" height="40" fill="#d9f7be" stroke="#52c41a" stroke-width="2" rx="5" />
  <text x="580" y="775" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">RiftCompiler (Multi-Pass Integration)</text>
  
  <!-- Draw connections -->
  <!-- RiftClient to Pipeline -->
  <line x1="560" y1="150" x2="230" y2="200" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" />
  <polygon points="230,200 240,190 220,190" fill="#000" />
  <text x="370" y="170" font-family="Arial" font-size="12">creates &gt;</text>
  
  <!-- RiftClient to Result -->
  <line x1="560" y1="150" x2="540" y2="200" stroke="#000" stroke-width="1.5" />
  <polygon points="540,200 535,190 545,190" fill="#000" />
  
  <!-- Pipeline to Tokenizer, Parser, AST Builder -->
  <line x1="230" y1="360" x2="230" y2="400" stroke="#000" stroke-width="1.5" />
  <polygon points="230,400 225,390 235,390" fill="#000" />
  
  <line x1="270" y1="360" x2="540" y2="400" stroke="#000" stroke-width="1.5" />
  <polygon points="540,400 533,392 530,385" fill="#000" />
  
  <line x1="310" y1="360" x2="850" y2="400" stroke="#000" stroke-width="1.5" />
  <polygon points="850,400 840,395 842,385" fill="#000" />
  
  <!-- Pipeline to Result -->
  <line x1="340" y1="280" x2="430" y2="280" stroke="#000" stroke-width="1.5" />
  <polygon points="430,280 420,275 420,285" fill="#000" />
  
  <!-- Tokenizer to Token -->
  <line x1="210" y1="580" x2="210" y2="620" stroke="#000" stroke-width="1.5" />
  <polygon points="210,620 205,610 215,610" fill="#000" />
  
  <!-- Parser to ParseTree -->
  <line x1="540" y1="580" x2="540" y2="620" stroke="#000" stroke-width="1.5" />
  <polygon points="540,620 535,610 545,610" fill="#000" />
  
  <!-- AstBuilder to AstNode -->
  <line x1="850" y1="580" x2="850" y2="620" stroke="#000" stroke-width="1.5" />
  <polygon points="850,620 845,610 855,610" fill="#000" />
  
  <!-- Result to Token, ParseTree, AstNode -->
  <line x1="430" y1="300" x2="210" y2="620" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" />
  <polygon points="210,620 215,610 205,610" fill="#000" />
  
  <line x1="540" y1="360" x2="540" y2="620" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" />
  <polygon points="540,620 535,610 545,610" fill="#000" />
  
  <line x1="650" y1="300" x2="850" y2="620" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" />
  <polygon points="850,620 845,610 855,610" fill="#000" />
  
  <!-- Multi-Pass connections -->
  <line x1="310" y1="490" x2="430" y2="490" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" />
  <text x="370" y="480" font-family="Arial" font-size="12">feeds</text>
  
  <line x1="650" y1="490" x2="740" y2="490" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" />
  <text x="695" y="480" font-family="Arial" font-size="12">feeds</text>
  
  <path d="M850,580 L850,600 L580,600 L580,750" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" fill="none" />
  <polygon points="580,750 575,740 585,740" fill="#000" />
  
  <path d="M540,580 L540,650 L550,680 L580,750" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" fill="none" />
  <polygon points="580,750 575,740 585,740" fill="#000" />
  
  <path d="M210,580 L210,700 L580,750" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" fill="none" />
  <polygon points="580,750 575,740 585,740" fill="#000" />
  
  <!-- RiftAutomatonFactory to Tokenizer, Parser, AstBuilder -->
  <line x1="740" y1="250" x2="250" y2="400" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" />
  <text x="450" y="320" font-family="Arial" font-size="12">provides automation for</text>
  
  <line x1="740" y1="280" x2="550" y2="400" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" />
  <text x="600" y="330" font-family="Arial" font-size="12">provides automation for</text>
  
  <line x1="890" y1="360" x2="890" y2="400" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" />
  <text x="890" y="385" font-family="Arial" font-size="12">provides automation for</text>
  
  <!-- Feedback loop for multi-pass -->
  <path d="M580,790 L100,790 L100,230 L120,230" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" fill="none" />
  <polygon points="120,230 110,225 110,235" fill="#000" />
  <text x="80" y="500" font-family="Arial" font-size="12" transform="rotate(90,80,500)">Multi-pass feedback loop</text>
</svg>